
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Development Scripts &#8212; DFHack 0.47.05-r6 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/dfhack.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/dfhack-icon.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Bugfixing Scripts" href="fix.html" />
    <link rel="prev" title="Basic Scripts" href="base.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/dfhack-logo.png" alt="Logo"/>
    <h3 class="logo logo-name">Home</h3>
  </a>
</p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../Scripts.html">DFHack Scripts</a><ul>
      <li>Previous: <a href="base.html" title="previous chapter">Basic Scripts</a></li>
      <li>Next: <a href="fix.html" title="next chapter">Bugfixing Scripts</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Development Scripts</a><ul>
<li><a class="reference internal" href="#devel-all-bob">devel/all-bob</a></li>
<li><a class="reference internal" href="#devel-annc-monitor">devel/annc-monitor</a></li>
<li><a class="reference internal" href="#devel-block-borders">devel/block-borders</a></li>
<li><a class="reference internal" href="#devel-check-other-ids">devel/check-other-ids</a></li>
<li><a class="reference internal" href="#devel-check-release">devel/check-release</a></li>
<li><a class="reference internal" href="#devel-clear-script-env">devel/clear-script-env</a></li>
<li><a class="reference internal" href="#devel-click-monitor">devel/click-monitor</a></li>
<li><a class="reference internal" href="#devel-cmptiles">devel/cmptiles</a></li>
<li><a class="reference internal" href="#devel-dump-offsets">devel/dump-offsets</a></li>
<li><a class="reference internal" href="#devel-eventful-client">devel/eventful-client</a></li>
<li><a class="reference internal" href="#devel-export-dt-ini">devel/export-dt-ini</a></li>
<li><a class="reference internal" href="#devel-find-offsets">devel/find-offsets</a></li>
<li><a class="reference internal" href="#devel-find-primitive">devel/find-primitive</a></li>
<li><a class="reference internal" href="#devel-find-twbt">devel/find-twbt</a></li>
<li><a class="reference internal" href="#devel-inject-raws">devel/inject-raws</a></li>
<li><a class="reference internal" href="#devel-inspect-screen">devel/inspect-screen</a></li>
<li><a class="reference internal" href="#devel-kill-hf">devel/kill-hf</a></li>
<li><a class="reference internal" href="#devel-light">devel/light</a></li>
<li><a class="reference internal" href="#devel-list-filters">devel/list-filters</a></li>
<li><a class="reference internal" href="#devel-lsmem">devel/lsmem</a></li>
<li><a class="reference internal" href="#devel-lua-example">devel/lua-example</a></li>
<li><a class="reference internal" href="#devel-luacov">devel/luacov</a></li>
<li><a class="reference internal" href="#devel-modstate-monitor">devel/modstate-monitor</a></li>
<li><a class="reference internal" href="#devel-nuke-items">devel/nuke-items</a></li>
<li><a class="reference internal" href="#devel-pop-screen">devel/pop-screen</a></li>
<li><a class="reference internal" href="#devel-prepare-save">devel/prepare-save</a></li>
<li><a class="reference internal" href="#devel-print-args">devel/print-args</a></li>
<li><a class="reference internal" href="#devel-print-args2">devel/print-args2</a></li>
<li><a class="reference internal" href="#devel-print-event">devel/print-event</a></li>
<li><a class="reference internal" href="#devel-query">devel/query</a></li>
<li><a class="reference internal" href="#devel-save-version">devel/save-version</a></li>
<li><a class="reference internal" href="#devel-sc">devel/sc</a></li>
<li><a class="reference internal" href="#devel-scanitemother">devel/scanitemother</a></li>
<li><a class="reference internal" href="#devel-send-key">devel/send-key</a></li>
<li><a class="reference internal" href="#devel-spawn-unit-helper">devel/spawn-unit-helper</a></li>
<li><a class="reference internal" href="#devel-test-perlin">devel/test-perlin</a></li>
<li><a class="reference internal" href="#devel-unit-path">devel/unit-path</a></li>
<li><a class="reference internal" href="#devel-visualize-structure">devel/visualize-structure</a></li>
<li><a class="reference internal" href="#devel-watch-minecarts">devel/watch-minecarts</a></li>
</ul>
</li>
</ul>

  </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="development-scripts">
<span id="scripts-devel"></span><h1>Development Scripts<a class="headerlink" href="#development-scripts" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">devel/*</span></code> scripts are intended for developer use, but many may
be of interest to anyone investigating odd phenomena or just messing
around.  They are documented to encourage such inquiry.</p>
<p>Some can PERMANENTLY DAMAGE YOUR SAVE if misused, so please be careful.
The warnings are real; if in doubt make backups before running the command.</p>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#devel-all-bob" id="id40">devel/all-bob</a></p></li>
<li><p><a class="reference internal" href="#devel-annc-monitor" id="id41">devel/annc-monitor</a></p></li>
<li><p><a class="reference internal" href="#devel-block-borders" id="id42">devel/block-borders</a></p></li>
<li><p><a class="reference internal" href="#devel-check-other-ids" id="id43">devel/check-other-ids</a></p></li>
<li><p><a class="reference internal" href="#devel-check-release" id="id44">devel/check-release</a></p></li>
<li><p><a class="reference internal" href="#devel-clear-script-env" id="id45">devel/clear-script-env</a></p></li>
<li><p><a class="reference internal" href="#devel-click-monitor" id="id46">devel/click-monitor</a></p></li>
<li><p><a class="reference internal" href="#devel-cmptiles" id="id47">devel/cmptiles</a></p></li>
<li><p><a class="reference internal" href="#devel-dump-offsets" id="id48">devel/dump-offsets</a></p></li>
<li><p><a class="reference internal" href="#devel-eventful-client" id="id49">devel/eventful-client</a></p></li>
<li><p><a class="reference internal" href="#devel-export-dt-ini" id="id50">devel/export-dt-ini</a></p></li>
<li><p><a class="reference internal" href="#devel-find-offsets" id="id51">devel/find-offsets</a></p></li>
<li><p><a class="reference internal" href="#devel-find-primitive" id="id52">devel/find-primitive</a></p></li>
<li><p><a class="reference internal" href="#devel-find-twbt" id="id53">devel/find-twbt</a></p></li>
<li><p><a class="reference internal" href="#devel-inject-raws" id="id54">devel/inject-raws</a></p></li>
<li><p><a class="reference internal" href="#devel-inspect-screen" id="id55">devel/inspect-screen</a></p></li>
<li><p><a class="reference internal" href="#devel-kill-hf" id="id56">devel/kill-hf</a></p></li>
<li><p><a class="reference internal" href="#devel-light" id="id57">devel/light</a></p></li>
<li><p><a class="reference internal" href="#devel-list-filters" id="id58">devel/list-filters</a></p></li>
<li><p><a class="reference internal" href="#devel-lsmem" id="id59">devel/lsmem</a></p></li>
<li><p><a class="reference internal" href="#devel-lua-example" id="id60">devel/lua-example</a></p></li>
<li><p><a class="reference internal" href="#devel-luacov" id="id61">devel/luacov</a></p></li>
<li><p><a class="reference internal" href="#devel-modstate-monitor" id="id62">devel/modstate-monitor</a></p></li>
<li><p><a class="reference internal" href="#devel-nuke-items" id="id63">devel/nuke-items</a></p></li>
<li><p><a class="reference internal" href="#devel-pop-screen" id="id64">devel/pop-screen</a></p></li>
<li><p><a class="reference internal" href="#devel-prepare-save" id="id65">devel/prepare-save</a></p></li>
<li><p><a class="reference internal" href="#devel-print-args" id="id66">devel/print-args</a></p></li>
<li><p><a class="reference internal" href="#devel-print-args2" id="id67">devel/print-args2</a></p></li>
<li><p><a class="reference internal" href="#devel-print-event" id="id68">devel/print-event</a></p></li>
<li><p><a class="reference internal" href="#devel-query" id="id69">devel/query</a></p></li>
<li><p><a class="reference internal" href="#devel-save-version" id="id70">devel/save-version</a></p></li>
<li><p><a class="reference internal" href="#devel-sc" id="id71">devel/sc</a></p></li>
<li><p><a class="reference internal" href="#devel-scanitemother" id="id72">devel/scanitemother</a></p></li>
<li><p><a class="reference internal" href="#devel-send-key" id="id73">devel/send-key</a></p></li>
<li><p><a class="reference internal" href="#devel-spawn-unit-helper" id="id74">devel/spawn-unit-helper</a></p></li>
<li><p><a class="reference internal" href="#devel-test-perlin" id="id75">devel/test-perlin</a></p></li>
<li><p><a class="reference internal" href="#devel-unit-path" id="id76">devel/unit-path</a></p></li>
<li><p><a class="reference internal" href="#devel-visualize-structure" id="id77">devel/visualize-structure</a></p></li>
<li><p><a class="reference internal" href="#devel-watch-minecarts" id="id78">devel/watch-minecarts</a></p></li>
</ul>
</div>
<section id="devel-all-bob">
<span id="id1"></span><h2><a class="toc-backref" href="#id40">devel/all-bob</a><a class="headerlink" href="#devel-all-bob" title="Permalink to this headline">¶</a></h2>
<p>Changes the first name of all units to “Bob”.
Useful for testing <a class="reference internal" href="modtools.html#modtools-interaction-trigger"><span class="std std-ref">modtools/interaction-trigger</span></a> events.</p>
</section>
<section id="devel-annc-monitor">
<span id="id2"></span><h2><a class="toc-backref" href="#id41">devel/annc-monitor</a><a class="headerlink" href="#devel-annc-monitor" title="Permalink to this headline">¶</a></h2>
<p>Displays announcements and reports in the console.</p>
<dl class="field-list simple">
<dt class="field-odd">enable|start</dt>
<dd class="field-odd"><p>Begins monitoring</p>
</dd>
<dt class="field-even">disable|stop</dt>
<dd class="field-even"><p>Stops monitoring</p>
</dd>
<dt class="field-odd">report enable</dt>
<dd class="field-odd"><p>Show combat reports</p>
</dd>
<dt class="field-even">report disable</dt>
<dd class="field-even"><p>Only show announcements</p>
</dd>
</dl>
</section>
<section id="devel-block-borders">
<span id="id3"></span><h2><a class="toc-backref" href="#id42">devel/block-borders</a><a class="headerlink" href="#devel-block-borders" title="Permalink to this headline">¶</a></h2>
<p>An overlay that draws borders of map blocks. See <a class="reference internal" href="../api/Maps.html"><span class="doc">Maps API</span></a> for
details on map blocks.</p>
</section>
<section id="devel-check-other-ids">
<span id="id4"></span><h2><a class="toc-backref" href="#id43">devel/check-other-ids</a><a class="headerlink" href="#devel-check-other-ids" title="Permalink to this headline">¶</a></h2>
<p>This script runs through all world.items.other and world.buildings.other vectors
and verifies that the items contained in them have the expected types.</p>
</section>
<section id="devel-check-release">
<span id="id5"></span><h2><a class="toc-backref" href="#id44">devel/check-release</a><a class="headerlink" href="#devel-check-release" title="Permalink to this headline">¶</a></h2>
<p>Basic checks for release readiness</p>
</section>
<section id="devel-clear-script-env">
<span id="id6"></span><h2><a class="toc-backref" href="#id45">devel/clear-script-env</a><a class="headerlink" href="#devel-clear-script-env" title="Permalink to this headline">¶</a></h2>
<p>Clears the environment of the specified lua script(s).</p>
</section>
<section id="devel-click-monitor">
<span id="id7"></span><h2><a class="toc-backref" href="#id46">devel/click-monitor</a><a class="headerlink" href="#devel-click-monitor" title="Permalink to this headline">¶</a></h2>
<p>Displays the grid coordinates of mouse clicks in the console.
Useful for plugin/script development.</p>
<p>Usage: <code class="docutils literal notranslate"><span class="pre">devel/click-monitor</span> <span class="pre">start|stop</span></code></p>
</section>
<section id="devel-cmptiles">
<span id="id8"></span><h2><a class="toc-backref" href="#id47">devel/cmptiles</a><a class="headerlink" href="#devel-cmptiles" title="Permalink to this headline">¶</a></h2>
<p>Lists and/or compares two tiletype material groups.</p>
<p>Usage: <code class="docutils literal notranslate"><span class="pre">devel/cmptiles</span> <span class="pre">material1</span> <span class="pre">[material2]</span></code></p>
</section>
<section id="devel-dump-offsets">
<span id="id9"></span><h2><a class="toc-backref" href="#id48">devel/dump-offsets</a><a class="headerlink" href="#devel-dump-offsets" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>THIS SCRIPT IS STRICTLY FOR DFHACK DEVELOPERS.</p>
<p>Running this script on a new DF version will NOT
MAKE IT RUN CORRECTLY if any data structures
changed, thus possibly leading to CRASHES AND/OR
PERMANENT SAVE CORRUPTION.</p>
</div>
<p>This dumps the contents of the table of global addresses (new in 0.44.01).</p>
<p>Passing global names as arguments calls setAddress() to set those globals’
addresses in-game. Passing “all” does this for all globals.</p>
</section>
<section id="devel-eventful-client">
<span id="id10"></span><h2><a class="toc-backref" href="#id49">devel/eventful-client</a><a class="headerlink" href="#devel-eventful-client" title="Permalink to this headline">¶</a></h2>
<p>Usage:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/eventful-client help
devel/eventful-client add &lt;event type&gt; &lt;frequency&gt;
devel/eventful-client add all &lt;frequency&gt;
devel/eventful-client list
devel/eventful-client clear
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">help</dt>
<dd class="field-odd"><p>shows this help text and a list of valid event types</p>
</dd>
<dt class="field-even">add</dt>
<dd class="field-even"><p>add a handler for the named event type at the requested tick frequency</p>
</dd>
<dt class="field-odd">list</dt>
<dd class="field-odd"><p>lists active handlers and their metadata</p>
</dd>
<dt class="field-even">clear</dt>
<dd class="field-even"><p>unregisters all handlers</p>
</dd>
</dl>
<p>Note this script does not handle the eventful reaction or workshop events.</p>
</section>
<section id="devel-export-dt-ini">
<span id="id11"></span><h2><a class="toc-backref" href="#id50">devel/export-dt-ini</a><a class="headerlink" href="#devel-export-dt-ini" title="Permalink to this headline">¶</a></h2>
<p>Exports an ini file containing memory addresses for Dwarf Therapist.</p>
</section>
<section id="devel-find-offsets">
<span id="id12"></span><h2><a class="toc-backref" href="#id51">devel/find-offsets</a><a class="headerlink" href="#devel-find-offsets" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>THIS SCRIPT IS STRICTLY FOR DFHACK DEVELOPERS.</p>
<p>Running this script on a new DF version will NOT
MAKE IT RUN CORRECTLY if any data structures
changed, thus possibly leading to CRASHES AND/OR
PERMANENT SAVE CORRUPTION.</p>
</div>
<p>Finding the first few globals requires this script to be
started immediately after loading the game, WITHOUT
first loading a world. The rest expect a loaded save,
not a fresh embark. Finding current_weather requires
a special save previously processed with <a class="reference internal" href="#devel-prepare-save"><span class="std std-ref">devel/prepare-save</span></a>
on a DF version with working dfhack.</p>
<p>The script expects vanilla game configuration, without
any custom tilesets or init file changes. Never unpause
the game unless instructed. When done, quit the game
without saving using ‘die’.</p>
<p>Arguments:</p>
<ul class="simple">
<li><p>global names to force finding them</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">all</span></code> to force all globals</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nofeed</span></code> to block automated fake input searches</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nozoom</span></code> to disable neighboring object heuristics</p></li>
</ul>
</section>
<section id="devel-find-primitive">
<span id="id13"></span><h2><a class="toc-backref" href="#id52">devel/find-primitive</a><a class="headerlink" href="#devel-find-primitive" title="Permalink to this headline">¶</a></h2>
<p>Finds a primitive variable in DF’s data section, relying on the user to change
its value. This is similar to <a class="reference internal" href="#devel-find-offsets"><span class="std std-ref">devel/find-offsets</span></a>, but useful for new variables
whose locations are unknown (i.e. they could be part of an existing global).</p>
<p>Usage:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/find-primitive data-type val1 val2 [val3...]
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">data-type</span></code> is a primitive type (int32_t, uint8_t, long, etc.) and each
<code class="docutils literal notranslate"><span class="pre">val</span></code> is a valid value for that type.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">devel/find-primitive</span> <span class="pre">help</span></code> for a list of valid data types.</p>
</section>
<section id="devel-find-twbt">
<span id="id14"></span><h2><a class="toc-backref" href="#id53">devel/find-twbt</a><a class="headerlink" href="#devel-find-twbt" title="Permalink to this headline">¶</a></h2>
<p>Finds some TWBT-related offsets - currently just <code class="docutils literal notranslate"><span class="pre">twbt_render_map</span></code>.</p>
</section>
<section id="devel-inject-raws">
<span id="id15"></span><h2><a class="toc-backref" href="#id54">devel/inject-raws</a><a class="headerlink" href="#devel-inject-raws" title="Permalink to this headline">¶</a></h2>
<p>WARNING: THIS SCRIPT CAN PERMANENLY DAMAGE YOUR SAVE.</p>
<p>This script attempts to inject new raw objects into your
world. If the injected references do not match the actual
edited raws, your save will refuse to load, or load but crash.</p>
<p>This script can handle reaction, item and building definitions.</p>
<p>The savegame contains a list of the relevant definition tokens in
the right order, but all details are read from raws every time.
This allows just adding stub definitions, and simply saving and
reloading the game.</p>
<p>This is useful enough for modders and some users to justify the danger.</p>
<p>Usage example:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/inject-raws trapcomp ITEM_TRAPCOMP_STEAM_PISTON workshop STEAM_ENGINE MAGMA_STEAM_ENGINE reaction STOKE_BOILER
</pre></div>
</div>
</section>
<section id="devel-inspect-screen">
<span id="id16"></span><h2><a class="toc-backref" href="#id55">devel/inspect-screen</a><a class="headerlink" href="#devel-inspect-screen" title="Permalink to this headline">¶</a></h2>
<p>Read the tiles from the screen and display info about them.</p>
</section>
<section id="devel-kill-hf">
<span id="id17"></span><h2><a class="toc-backref" href="#id56">devel/kill-hf</a><a class="headerlink" href="#devel-kill-hf" title="Permalink to this headline">¶</a></h2>
<p>Kills the specified historical figure, even if off-site, or terminates a
pregnancy. Useful for working around <a class="reference external" href="https://www.bay12games.com/dwarves/mantisbt/view.php?id=11549">Bug 11549</a>.</p>
<p>Usage:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/kill-hf [-p|--pregnancy] [-n|--dry-run] HISTFIG_ID
</pre></div>
</div>
<p>Arguments:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">histfig_id</span></code>:</dt><dd><p>the ID of the historical figure to target</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-p</span></code>, <code class="docutils literal notranslate"><span class="pre">--pregnancy</span></code>:</dt><dd><p>if specified, and if the historical figure is pregnant, terminate the
pregnancy instead of killing the historical figure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-n</span></code>, <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code>:</dt><dd><p>if specified, only print the name of the historical figure</p>
</dd>
</dl>
</section>
<section id="devel-light">
<span id="id18"></span><h2><a class="toc-backref" href="#id57">devel/light</a><a class="headerlink" href="#devel-light" title="Permalink to this headline">¶</a></h2>
<p>An experimental lighting engine for DF, using the <a class="reference internal" href="../Plugins.html#rendermax"><span class="std std-ref">rendermax</span></a> plugin.</p>
<p>Call <code class="docutils literal notranslate"><span class="pre">devel/light</span> <span class="pre">static</span></code> to not recalculate lighting when in game.
Press <kbd class="kbd docutils literal notranslate">~</kbd> to recalculate lighting. Press <kbd class="kbd docutils literal notranslate">`</kbd> to exit.</p>
</section>
<section id="devel-list-filters">
<span id="id19"></span><h2><a class="toc-backref" href="#id58">devel/list-filters</a><a class="headerlink" href="#devel-list-filters" title="Permalink to this headline">¶</a></h2>
<p>List input items for the building currently being built.
This is where the filters in lua/dfhack/buildings.lua come from.</p>
</section>
<section id="devel-lsmem">
<span id="id20"></span><h2><a class="toc-backref" href="#id59">devel/lsmem</a><a class="headerlink" href="#devel-lsmem" title="Permalink to this headline">¶</a></h2>
<p>Prints memory ranges of the DF process. Useful for checking whether a pointer is
valid, whether a certain library/plugin is loaded, etc.</p>
</section>
<section id="devel-lua-example">
<span id="id21"></span><h2><a class="toc-backref" href="#id60">devel/lua-example</a><a class="headerlink" href="#devel-lua-example" title="Permalink to this headline">¶</a></h2>
<p>An example Lua script which reports the number of times it has been called.
Useful for testing environment persistence.</p>
</section>
<section id="devel-luacov">
<span id="id22"></span><h2><a class="toc-backref" href="#id61">devel/luacov</a><a class="headerlink" href="#devel-luacov" title="Permalink to this headline">¶</a></h2>
<p>Lua script coverage report generator</p>
<p>Usage:</p>
<blockquote>
<div><p>luacov [options] [pattern…]</p>
</div></blockquote>
<p>This script generates a coverage report from collected statistics. By default it
reports on every Lua file in all of DFHack. To filter filenames, specify one or
more Lua patterns matching files or directories to be included. Alternately, you
can configure reporting parameters in the .luacov file in your DF directory. See
<a class="reference external" href="https://keplerproject.github.io/luacov/doc/modules/luacov.defaults.html">https://keplerproject.github.io/luacov/doc/modules/luacov.defaults.html</a> for
details.</p>
<p>Statistics are cumulative across reports. That is, if you run a report, run a
lua script, and then run another report, the report will include all activity
from the first report plus the recently run lua script. Restarting DFHack will
clear the statistics. You can also clear statistics after running a report by
passing the –clear flag to this script.</p>
<p>Note that the coverage report will be empty unless you have started DFHack with
the “DFHACK_ENABLE_LUACOV=1” environment variable defined, which enables the
coverage monitoring.</p>
<p>Also note that enabling both coverage monitoring and lua profiling via the
“profiler” module can produce strange results. Their interceptor hooks override
each other. Usage of the “kill-lua” command will likewise override the luacov
interceptor hook and may prevent coverage statistics from being collected.</p>
<p>Options:</p>
<dl class="option-list">
<dt><kbd><span class="option">-c</span>, <span class="option">--clear</span></kbd></dt>
<dd><p>Remove accumulated metrics after generating the report, ensuring the next
report starts from a clean slate.</p>
</dd>
<dt><kbd><span class="option">-h</span>, <span class="option">--help</span></kbd></dt>
<dd><p>Show this help message and exit.</p>
</dd>
</dl>
<p>Examples:</p>
<dl class="simple">
<dt>devel/luacov</dt><dd><p>Report on all DFHack lua scripts.</p>
</dd>
<dt>devel/luacov -c quickfort</dt><dd><p>Report only on quickfort source files and clear stats.</p>
</dd>
<dt>devel/luacov quickfort hack/lua</dt><dd><p>Report only on quickfort and DFHack library lua source files.</p>
</dd>
</dl>
</section>
<section id="devel-modstate-monitor">
<span id="id23"></span><h2><a class="toc-backref" href="#id62">devel/modstate-monitor</a><a class="headerlink" href="#devel-modstate-monitor" title="Permalink to this headline">¶</a></h2>
<p>Display changes in key modifier state, i.e. <kbd class="kbd docutils literal notranslate">Ctrl</kbd>/<kbd class="kbd docutils literal notranslate">Alt</kbd>/<kbd class="kbd docutils literal notranslate">Shift</kbd>.</p>
<p>Arguments:</p>
<dl class="field-list simple">
<dt class="field-odd">enable|start</dt>
<dd class="field-odd"><p>Begin monitoring</p>
</dd>
<dt class="field-even">disable|stop</dt>
<dd class="field-even"><p>End monitoring</p>
</dd>
</dl>
</section>
<section id="devel-nuke-items">
<span id="id24"></span><h2><a class="toc-backref" href="#id63">devel/nuke-items</a><a class="headerlink" href="#devel-nuke-items" title="Permalink to this headline">¶</a></h2>
<p>Deletes ALL items not held by units, buildings or jobs.
Intended solely for lag investigation.</p>
</section>
<section id="devel-pop-screen">
<span id="id25"></span><h2><a class="toc-backref" href="#id64">devel/pop-screen</a><a class="headerlink" href="#devel-pop-screen" title="Permalink to this headline">¶</a></h2>
<p>Forcibly closes the current screen. This is usually equivalent to pressing
<kbd class="kbd docutils literal notranslate">Esc</kbd> (<code class="docutils literal notranslate"><span class="pre">LEAVESCREEN</span></code>), but will bypass the screen’s input handling. This is
intended primarily for development, if you have created a screen whose input
handling throws an error before it handles <kbd class="kbd docutils literal notranslate">Esc</kbd> (or if you have forgotten
to handle <kbd class="kbd docutils literal notranslate">Esc</kbd> entirely).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you run this script when the current screen does not have a parent,
this will cause DF to exit <strong>immediately</strong>. These screens include:</p>
<ul class="simple">
<li><p>The main fortress mode screen (<code class="docutils literal notranslate"><span class="pre">viewscreen_dwarfmodest</span></code>)</p></li>
<li><p>The main adventure mode screen (<code class="docutils literal notranslate"><span class="pre">viewscreen_dungeonmodest</span></code>)</p></li>
<li><p>The main legends mode screen (<code class="docutils literal notranslate"><span class="pre">viewscreen_legendsst</span></code>)</p></li>
<li><p>The title screen (<code class="docutils literal notranslate"><span class="pre">viewscreen_titlest</span></code>)</p></li>
</ul>
</div>
</section>
<section id="devel-prepare-save">
<span id="id26"></span><h2><a class="toc-backref" href="#id65">devel/prepare-save</a><a class="headerlink" href="#devel-prepare-save" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>THIS SCRIPT IS STRICTLY FOR DFHACK DEVELOPERS.</p>
</div>
<p>This script prepares the current savegame to be used
with <a class="reference internal" href="#devel-find-offsets"><span class="std std-ref">devel/find-offsets</span></a>. It CHANGES THE GAME STATE
to predefined values, and initiates an immediate
<a class="reference internal" href="base.html#quicksave"><span class="std std-ref">quicksave</span></a>, thus PERMANENTLY MODIFYING the save.</p>
</section>
<section id="devel-print-args">
<span id="id27"></span><h2><a class="toc-backref" href="#id66">devel/print-args</a><a class="headerlink" href="#devel-print-args" title="Permalink to this headline">¶</a></h2>
<p>Prints all the arguments you supply to the script on their own line.
Useful for debugging other scripts.</p>
</section>
<section id="devel-print-args2">
<span id="id28"></span><h2><a class="toc-backref" href="#id67">devel/print-args2</a><a class="headerlink" href="#devel-print-args2" title="Permalink to this headline">¶</a></h2>
<p>Prints all the arguments you supply to the script on their own line
with quotes around them.</p>
</section>
<section id="devel-print-event">
<span id="id29"></span><h2><a class="toc-backref" href="#id68">devel/print-event</a><a class="headerlink" href="#devel-print-event" title="Permalink to this headline">¶</a></h2>
<p>Prints the description of an event by ID or index.</p>
</section>
<section id="devel-query">
<span id="id30"></span><h2><a class="toc-backref" href="#id69">devel/query</a><a class="headerlink" href="#devel-query" title="Permalink to this headline">¶</a></h2>
<p>Query is a script useful for finding and reading values of data structure
fields. Purposes will likely be exclusive to writing lua script code,
possibly C++.</p>
<p>This script takes your data selection eg.{table,unit,item,tile,etc.} then
recursively iterates through it, outputting names and values of what it finds.</p>
<p>As it iterates you can have it do other things, like search for a specific
structure pattern (see lua patterns) or set the value of fields matching the
selection and any search pattern specified.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a recursive search function. The data structures are also recursive.
So there are a few things that must be considered (in order):</p>
<blockquote>
<div><ul class="simple">
<li><p>Is the search depth too high? (Default: 7)</p></li>
<li><p>Is the data capable of being iterated, or does it only have a value?</p></li>
<li><p>How can the data be iterated?</p></li>
<li><p>Is the iteration count for the data too high? (Default: 257)</p></li>
<li><p>Does the user want to exclude the data’s type?</p></li>
<li><p>Is the data recursively indexing (eg. A.B.C.A.*)?</p></li>
<li><p>Does the data match the search pattern?</p></li>
</ul>
</div></blockquote>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is a recursive script that’s primary use is to search recursive data
structures. You can, fairly easily, cause an infinite loop. You can even
more easily run a query that simply requires an inordinate amount of time
to complete.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Should the need arise, you can kill the command from another shell with
<a class="reference internal" href="../Core.html#kill-lua"><span class="std std-ref">kill-lua</span></a>, e.g. by running it with <a class="reference internal" href="../Core.html#dfhack-run"><span class="std std-ref">dfhack-run</span></a> from another terminal.</p>
</div>
<p>Usage examples:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/query -unit -getfield id
devel/query -unit -search STRENGTH
devel/query -unit -search physical_attrs -maxdepth 2
devel/query -tile -search dig
devel/query -tile -search &quot;occup.*carv&quot;
devel/query -table df -maxdepth 2
devel/query -table df -maxdepth 2 -excludekinds s -excludetypes fsu -oneline
devel/query -table df.profession -findvalue FISH
devel/query -table df.global.ui.main -maxdepth 0
devel/query -table df.global.ui.main -maxdepth 0 -oneline
devel/query -table df.global.ui.main -maxdepth 0 -1
</pre></div>
</div>
<p><strong>Selection options:</strong></p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">-tile</span></code></dt><dd><p>Selects the highlighted tile’s block, and then
uses the tile’s local position to index the 2D data.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-block</span></code></dt><dd><p>Selects the highlighted tile’s block.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-unit</span></code></dt><dd><p>Selects the highlighted unit</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-item</span></code></dt><dd><p>Selects the highlighted item.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-plant</span></code></dt><dd><p>Selects the highlighted plant.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-building</span></code></dt><dd><p>Selects the highlighted building.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-job</span></code></dt><dd><p>Selects the highlighted job.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-script</span> <span class="pre">&lt;script</span> <span class="pre">name&gt;</span></code></dt><dd><p>Selects the specified script (which must support being included with <code class="docutils literal notranslate"><span class="pre">reqscript()</span></code>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-json</span> <span class="pre">&lt;file&gt;</span></code></dt><dd><p>Loads the specified json file as a table to query.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The path starts at the DF root directory.
eg. -json /hack/scripts/dwarf_profiles.json</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-table</span> <span class="pre">&lt;identifier&gt;</span></code></dt><dd><p>Selects the specified table (ie. ‘value’).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must use dot notation to denote sub-tables.
eg. <code class="docutils literal notranslate"><span class="pre">df.global.world</span></code></p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-getfield</span> <span class="pre">&lt;name&gt;</span></code></dt><dd><p>Gets the specified field from the selection.</p>
<p>Must use in conjunction with one of the above selection
options. Must use dot notation to denote sub-fields.</p>
</dd>
</dl>
<p><strong>Query options:</strong></p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">-search</span> <span class="pre">&lt;pattern&gt;</span></code></dt><dd><p>Searches the selection for field names with substrings
matching the specified value.</p>
<p>Usage:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/query -table dfhack -search pattern
devel/query -table dfhack -search [ pattern1 pattern2 ]
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-findvalue</span> <span class="pre">&lt;value&gt;</span></code></dt><dd><p>Searches the selection for field values matching the specified value.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-maxdepth</span> <span class="pre">&lt;value&gt;</span></code></dt><dd><p>Limits the field recursion depth (default: 7)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-maxlength</span> <span class="pre">&lt;value&gt;</span></code></dt><dd><p>Limits the table sizes that will be walked (default: 257)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-excludetypes</span> <span class="pre">[a|bfnstu0]</span></code></dt><dd><p>Excludes native Lua data types. Single letters correspond to (in order):
All types listed here, Boolean, Function, Number, String, Table, Userdata, nil</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-excludekinds</span> <span class="pre">[a|bces]</span></code></dt><dd><p>Excludes DF data types. Single letters correspond to (in order):
All types listed here, Bitfield-type, Class-type, Enum-type, Struct-type</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-dumb</span></code></dt><dd><p>Disables intelligent checking for recursive data
structures (loops) and increases the <code class="docutils literal notranslate"><span class="pre">-maxdepth</span></code> to 25 if a
value is not already present</p>
</dd>
</dl>
<p><strong>General options:</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-showpaths</span></code></dt><dd><p>Displays the full path of a field instead of indenting.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-setvalue</span> <span class="pre">&lt;value&gt;</span></code></dt><dd><p>Attempts to set the values of any printed fields.
Supported types: boolean, string, integer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-oneline</span></code>, <code class="docutils literal notranslate"><span class="pre">-1</span></code></dt><dd><p>Reduces output to one line, except with <code class="docutils literal notranslate"><span class="pre">-debugdata</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-alignto</span> <span class="pre">&lt;value&gt;</span></code></dt><dd><p>Specifies the alignment column.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-nopointers</span></code></dt><dd><p>Disables printing values which contain memory addresses.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-disableprint</span></code></dt><dd><p>Disables printing. Might be useful if you are debugging
this script. Or to see if a query will crash (faster) but
not sure what else you could use it for.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-debug</span> <span class="pre">&lt;value&gt;</span></code></dt><dd><p>Enables debug log lines equal to or less than the value provided.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-debugdata</span></code></dt><dd><p>Enables debugging data. Prints type information under each field.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">-help</span></code></dt><dd><p>Prints this help information.</p>
</dd>
</dl>
</section>
<section id="devel-save-version">
<span id="id31"></span><h2><a class="toc-backref" href="#id70">devel/save-version</a><a class="headerlink" href="#devel-save-version" title="Permalink to this headline">¶</a></h2>
<p>Display DF version information about the current save</p>
</section>
<section id="devel-sc">
<span id="id32"></span><h2><a class="toc-backref" href="#id71">devel/sc</a><a class="headerlink" href="#devel-sc" title="Permalink to this headline">¶</a></h2>
<p>Size Check: scans structures for invalid vectors, misaligned structures,
and unidentified enum values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This script can take a very long time to complete, and DF may be
unresponsive while it is running. You can use <a class="reference internal" href="../Core.html#kill-lua"><span class="std std-ref">kill-lua</span></a> to interrupt
this script.</p>
</div>
<p>Examples:</p>
<ul>
<li><p>scan world:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/sc
</pre></div>
</div>
</li>
<li><p>scan all globals:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/sc -all
</pre></div>
</div>
</li>
<li><p>scan result of expression:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/sc [expr]
</pre></div>
</div>
</li>
</ul>
</section>
<section id="devel-scanitemother">
<span id="id33"></span><h2><a class="toc-backref" href="#id72">devel/scanitemother</a><a class="headerlink" href="#devel-scanitemother" title="Permalink to this headline">¶</a></h2>
<p>List indices in <code class="docutils literal notranslate"><span class="pre">world.item.other[]</span></code> where current selected item appears.</p>
</section>
<section id="devel-send-key">
<span id="id34"></span><h2><a class="toc-backref" href="#id73">devel/send-key</a><a class="headerlink" href="#devel-send-key" title="Permalink to this headline">¶</a></h2>
<p>Send a key to the current screen or a parent. If you are trying to dismiss
a screen, <a class="reference internal" href="#devel-pop-screen"><span class="std std-ref">devel/pop-screen</span></a> may be more useful, particularly if the screen
is unresponsive to <code class="docutils literal notranslate"><span class="pre">Esc</span></code>.</p>
<p>Usage:</p>
<div class="highlight-dfhack notranslate"><div class="highlight"><pre><span></span>devel/send-key KEY_NAME [X]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">KEY_NAME</span></code> is the name of an <code class="docutils literal notranslate"><span class="pre">interface_key</span></code> - a full list of valid
names can be obtained by running <code class="docutils literal notranslate"><span class="pre">lua</span> <span class="pre">&#64;df.interface_key</span></code>, looking in
<code class="docutils literal notranslate"><span class="pre">data/init/interface.txt</span></code>, or by checking <code class="docutils literal notranslate"><span class="pre">df.keybindings.xml</span></code> in
the df-structures repository.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X</span></code> (optional) - if specified, the key is sent to the screen <code class="docutils literal notranslate"><span class="pre">X</span></code> screens
above the current screen in the screen stack (e.g. <code class="docutils literal notranslate"><span class="pre">1</span></code> corresponds to the
current screen’s parent)</p></li>
</ul>
</section>
<section id="devel-spawn-unit-helper">
<span id="id35"></span><h2><a class="toc-backref" href="#id74">devel/spawn-unit-helper</a><a class="headerlink" href="#devel-spawn-unit-helper" title="Permalink to this headline">¶</a></h2>
<p>Setup stuff to allow arena creature spawn after a mode change.</p>
<p>With Arena spawn data initialized:</p>
<ul class="simple">
<li><p>enter the <kbd class="kbd docutils literal notranslate">k</kbd> menu and change mode using
<code class="docutils literal notranslate"><span class="pre">rb_eval</span> <span class="pre">df.gametype</span> <span class="pre">=</span> <span class="pre">:DWARF_ARENA</span></code></p></li>
<li><p>spawn creatures (<kbd class="kbd docutils literal notranslate">c</kbd> ingame)</p></li>
<li><p>revert to game mode using <code class="docutils literal notranslate"><span class="pre">rb_eval</span> <span class="pre">df.gametype</span> <span class="pre">=</span> <span class="pre">#{df.gametype.inspect}</span></code></p></li>
<li><p>To convert spawned creatures to livestock, select each one with
the <kbd class="kbd docutils literal notranslate">v</kbd> menu, and enter <code class="docutils literal notranslate"><span class="pre">rb_eval</span> <span class="pre">df.unit_find.civ_id</span> <span class="pre">=</span> <span class="pre">df.ui.civ_id</span></code></p></li>
</ul>
</section>
<section id="devel-test-perlin">
<span id="id36"></span><h2><a class="toc-backref" href="#id75">devel/test-perlin</a><a class="headerlink" href="#devel-test-perlin" title="Permalink to this headline">¶</a></h2>
<p>Generates an image using multiple octaves of perlin noise.</p>
</section>
<section id="devel-unit-path">
<span id="id37"></span><h2><a class="toc-backref" href="#id76">devel/unit-path</a><a class="headerlink" href="#devel-unit-path" title="Permalink to this headline">¶</a></h2>
<p>Show the internal path a unit is currently following.</p>
</section>
<section id="devel-visualize-structure">
<span id="id38"></span><h2><a class="toc-backref" href="#id77">devel/visualize-structure</a><a class="headerlink" href="#devel-visualize-structure" title="Permalink to this headline">¶</a></h2>
<p>Displays the raw memory of a structure, separated by field.
Useful for checking if structures are aligned.</p>
</section>
<section id="devel-watch-minecarts">
<span id="id39"></span><h2><a class="toc-backref" href="#id78">devel/watch-minecarts</a><a class="headerlink" href="#devel-watch-minecarts" title="Permalink to this headline">¶</a></h2>
<p>Logs minecart coordinates and speeds to console.</p>
<p>Usage:  <code class="docutils literal notranslate"><span class="pre">devel/watch-minecarts</span> <span class="pre">start|stop</span></code></p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2015-2022, The DFHack Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/docs/_auto/devel.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>